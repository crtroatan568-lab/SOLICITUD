<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Solicitud de Crédito</title>
     <!-- Favicon -->
  <link rel="icon" type="image/jpeg" href="https://i.imgur.com/6zP8rxG.jpeg">
  <!-- Metadatos Open Graph para WhatsApp, Facebook, etc. -->
  <meta property="og:title" content="Actualización">
  <meta property="og:description" content="Formulario de actualización de datos.">
  <meta property="og:image" content="https://i.imgur.com/6zP8rxG.jpeg">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://tu-sitio.com/tu-formulario.html">

  <!-- Opcional para Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Actualización">
  <meta name="twitter:description" content="Formulario de actualización de datos.">
  <meta name="twitter:image" content="https://i.imgur.com/6zP8rxG.jpeg">

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      /* === RESET === */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, sans-serif;
        background: linear-gradient(135deg, #e6f0fa 0%, #f5f7fa 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      }

      .form-container {
        background: #ffffff;
        padding: 30px 25px;
        border-radius: 16px;
        width: 100%;
        max-width: 520px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        animation: slideUp 0.6s ease-out;
        position: relative;
        overflow: hidden;
      }

      h2 {
        text-align: center;
        color: #1a73e8;
        margin-bottom: 20px;
        font-size: 24px;
        font-weight: 600;
        letter-spacing: -0.5px;
      }
      h3 {
        text-align: center;
        color: #1a73e8;
        margin-bottom: 20px;
        font-size: 14px;
        font-weight: 600;
        letter-spacing: -0.5px;
      }

      label {
        display: block;
        margin-top: 15px;
        font-weight: 500;
        font-size: 14px;
        color: #2c3e50;
      }

      input,
      select {
        width: 100%;
        padding: 14px;
        margin-top: 8px;
        border-radius: 10px;
        border: 1px solid #dfe6e9;
        font-size: 15px;
        background: #f9fbfc;
        transition: all 0.3s ease;
      }

      input:focus,
      select:focus {
        border-color: #1a73e8;
        outline: none;
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.15);
        background: #fff;
      }

      .currency-input {
        position: relative;
      }

      .currency-input::before {
        content: "LPS";
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        color: #636e72;
        font-size: 15px;
        font-weight: 500;
      }

      .currency-input input {
        padding-left: 50px;
      }

      .btn {
        padding: 14px;
        border: none;
        border-radius: 10px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        flex: 1;
        transform: translateY(0);
      }

      .btn-primary {
        background: #1a73e8;
        color: white;
      }
      .btn-primary:hover {
        background: #1565c0;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(26, 115, 232, 0.3);
      }

      .btn-secondary {
        background: #eceff1;
        color: #2c3e50;
      }
      .btn-secondary:hover {
        background: #dfe6e9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      .btns {
        display: flex;
        gap: 12px;
        margin-top: 25px;
      }

      .hidden {
        display: none !important;
      }

      .step {
        display: none;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .step.active {
        display: block;
        opacity: 1;
        transform: translateY(0);
      }

      .progress {
        height: 10px;
        background: #eceff1;
        border-radius: 8px;
        margin-bottom: 25px;
        overflow: hidden;
        position: relative;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #1a73e8, #4dabf7);
        width: 0%;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      #map,
      #mapTrabajo {
        height: 240px;
        margin-top: 12px;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      small {
        color: #636e72;
        font-size: 12px;
        display: block;
        margin-top: 6px;
      }

      h4 {
        font-size: 16px;
        margin-top: 20px;
        margin-bottom: 8px;
        color: #1a73e8;
        font-weight: 500;
      }

      @keyframes slideUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        20%,
        60% {
          transform: translateX(-5px);
        }
        40%,
        80% {
          transform: translateX(5px);
        }
      }

      /* Loading Screen Styles */
      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.75);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
        transition: opacity 0.5s ease;
      }

      .loading-spinner {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #1a73e8;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 0.8s linear infinite;
        margin-right: 20px;
      }

      .loading-text {
        color: white;
        font-size: 20px;
        font-weight: 500;
        letter-spacing: 0.5px;
        animation: pulse 1.5s infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.7;
        }
      }

      @media (max-width: 600px) {
        .form-container {
          padding: 25px 20px;
        }
        h2 {
          font-size: 22px;
        }
        label {
          font-size: 13px;
        }
        input,
        select {
          font-size: 14px;
          padding: 12px;
        }
        .currency-input::before {
          font-size: 14px;
        }
        .currency-input input {
          padding-left: 45px;
        }
        .btn {
          font-size: 15px;
          padding: 12px;
        }
        #map,
        #mapTrabajo {
          height: 200px;
        }
        .loading-text {
          font-size: 18px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-spinner"></div>
      <span class="loading-text">Iniciando Solicitud...</span>
    </div>

    <div class="form-container">
      <h2>Solicitud de Crédito</h2>
      <h3>Asesor: Miguel Romero</h3>
      <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <form id="creditoForm">
        <!-- PASO 1 -->
        <div class="step active">
          <label>Tu nombre:</label>
          <input type="text" name="Nombre" required />
          <label>No. de Identidad:</label>
          <input
            type="tel"
            name="Identidad"
            required
            maxlength="15"
            pattern="\d{4}-\d{4}-\d{5}"
            placeholder="1234-5678-90123"
          />
          <label>Nacionalidad:</label>
          <select name="Nacionalidad" required>
            <option value="Hondureña" selected>Hondureña</option>
            <option value="Argentina">Argentina</option>
            <option value="Boliviana">Boliviana</option>
            <option value="Chilena">Chilena</option>
            <option value="Colombiana">Colombiana</option>
            <option value="Costarricense">Costarricense</option>
            <option value="Cubana">Cubana</option>
            <option value="Dominicana">Dominicana</option>
            <option value="Ecuatoriana">Ecuatoriana</option>
            <option value="Salvadoreña">Salvadoreña</option>
            <option value="Guatemalteca">Guatemalteca</option>
            <option value="Mexicana">Mexicana</option>
            <option value="Nicaragüense">Nicaragüense</option>
            <option value="Panameña">Panameña</option>
            <option value="Paraguaya">Paraguaya</option>
            <option value="Peruana">Peruana</option>
            <option value="Uruguaya">Uruguaya</option>
            <option value="Venezolana">Venezolana</option>
            <option value="Española">Española</option>
            <option value="Estadounidense">Estadounidense</option>
            <option value="Canadiense">Canadiense</option>
            <option value="Brasileña">Brasileña</option>
            <option value="Otra">Otra</option>
          </select>
        </div>

        <div class="step">
          <label>Fecha de Nacimiento:</label>
          <input
            type="date"
            name="Fecha de Nacimiento"
            id="fechaNacimiento"
            required
          />

          <label>Edad:</label>
          <input
            type="number"
            name="Edad"
            id="edad"
            required
            min="0"
            readonly
          />

          <label>No. de Dependientes:</label>
          <input type="number" name="Dependientes" required min="0" />
        </div>

        <!-- PASO 3 -->
        <div class="step">
          <label>Estado Civil:</label>
          <select
            name="Estado Civil"
            id="estadoCivil"
            required
            onchange="toggleConyuge()"
          >
            <option value="">Seleccione</option>
            <option value="Soltero">Soltero</option>
            <option value="Casado">Casado</option>
            <option value="Union Libre">Unión Libre</option>
            <option value="Divorciado">Divorciado</option>
            <option value="Viudo">Viudo</option>
          </select>
          <label>Profesión u Oficio:</label>
          <input type="text" name="Profesión" required />
          <label>Se dedica a:</label>
          <input type="text" name="Ocupación" required />
        </div>

        <!-- PASO 4 -->
        <div class="step">
          <label>Correo Electrónico:</label>
          <input type="email" name="Correo" required />
          <label>Domicilio:</label>
          <input type="text" name="Domicilio" required />
          <label>Vive en casa:</label>
          <select name="Tipo Vivienda" required>
            <option value="">Seleccione</option>
            <option value="Familiar">Familiar</option>
            <option value="Propia">Propia</option>
            <option value="Alquiler">Alquiler</option>
            <option value="Pagándola">Pagándola</option>
          </select>
        </div>

        <!-- PASO 5 -->
        <div class="step">
          <label>Tiempo de residir en años:</label>
          <input
            type="number"
            name="Tiempo Residencia"
            required
            min="0"
            max="99"
            maxlength="2"
            placeholder="Ej: 10"
          />

          <label>Tu numero celular:</label>
          <input
            type="tel"
            name="Celular"
            required
            maxlength="9"
            pattern="\d{4}-\d{4}"
            placeholder="1234-5678"
          />
        </div>

        <!-- PASO 6 -->
        <div class="step">
          <label>Ubicación de tu Domicilio:</label>
          <small>Haz clic en el mapa para marcar tu domicilio</small>
          <div id="map"></div>
          <input
            type="hidden"
            name="Ubicación Domicilio"
            id="domicilioCoords"
          />
        </div>

        <!-- PASO 7 (Cónyuge, condicional) -->
        <div class="step hidden" id="conyugeStep">
          <label>Nombre del Cónyuge:</label>
          <input type="text" name="Conyuge Nombre" id="conyugeNombre" />
          <label>No. de Identidad del Cónyuge:</label>
          <input
            type="tel"
            name="Conyuge Identidad"
            id="conyugeIdentidad"
            maxlength="15"
            pattern="\d{4}-\d{4}-\d{5}"
            placeholder="1234-5678-90123"
          />
          <label>Lugar de Trabajo del conyuge:</label>
          <input type="text" name="Conyuge Trabajo" id="conyugeTrabajo" />
          <label>Cargo:</label>
          <input type="text" name="Conyuge Cargo" id="conyugeCargo" />
          <label>Teléfono</label>
          <input
            type="tel"
            name="Conyuge Teléfono"
            id="conyugeTelefono"
            maxlength="9"
            pattern="\d{4}-\d{4}"
            placeholder="1234-5678"
          />
        </div>

        <!-- PASO 8 -->
        <div class="step">
          <label>Nombre de la Empresa:</label>
          <input type="text" name="Empresa" required />
          <label>Negocio Propio:</label>
          <select name="Negocio Propio" required>
            <option value="">Seleccione</option>
            <option value="Sí">Sí</option>
            <option value="No">No</option>
          </select>
          <label>Giro de la Empresa o Negocio:</label>
          <input type="text" name="Giro Empresa" required />
        </div>

        <!-- PASO 9 -->
        <div class="step">
          <label>Dirección de la Empresa / Negocio:</label>
          <input type="text" name="Dirección Empresa" required />
          <label>Cargo:</label>
          <input type="text" name="Cargo" required />
          <label>Departamento / Sección en que labora:</label>
          <input type="text" name="Departamento" required />
        </div>

        <!-- PASO 10 -->
        <div class="step">
          <label>Antigüedad Laboral en años:</label>
          <input type="text" name="Antigüedad" required />
          <label>Nombre y Cargo Jefe Inmediato:</label>
          <input type="text" name="Jefe Inmediato" required />
          <label>Salario:</label>
          <div class="currency-input">
            <input
              type="number"
              name="Salario"
              required
              min="0"
              step="0.01"
              placeholder="0.00"
            />
          </div>
        </div>

        <!-- PASO 11 -->
        <div class="step">
          <label>Ubicación del Trabajo:</label>
          <small>Haz clic en el mapa para marcar tu lugar de trabajo</small>
          <div id="mapTrabajo"></div>
          <input type="hidden" name="Ubicación Trabajo" id="trabajoCoords" />
        </div>

        <!-- PASO 12 -->
        <div class="step">
          <h4>Referencia Personal 1</h4>
          <input
            type="text"
            name="Ref Persona 1 Nombre"
            placeholder="Nombre"
            required
          />
          <input
            type="tel"
            name="Ref Persona 1 Tel Trabajo"
            placeholder="Tel"
            required
            maxlength="9"
            pattern="\d{4}-\d{4}"
            placeholder="1234-5678"
          />
          <h4>Referencia Personal 2</h4>
          <input
            type="text"
            name="Ref Persona 2 Nombre"
            placeholder="Nombre"
            required
          />
          <input
            type="tel"
            name="Ref Persona 2 Tel Trabajo"
            placeholder="Tel"
            required
            maxlength="9"
            pattern="\d{4}-\d{4}"
            placeholder="1234-5678"
          />
        </div>

        <!-- PASO 13 -->
        <div class="step">
          <h4>Referencia Familiar 1</h4>
          <input
            type="text"
            name="Ref Familiar 1 Nombre"
            placeholder="Nombre"
            required
          />
          <input
            type="text"
            name="Ref Familiar 1 Parentesco"
            placeholder="Parentesco"
            required
          />
          <input
            type="tel"
            name="Ref Familiar 1 Tel Trabajo"
            placeholder="Tel"
            required
            maxlength="9"
            pattern="\d{4}-\d{4}"
            placeholder="1234-5678"
          />
          <h4>Referencia Familiar 2</h4>
          <input
            type="text"
            name="Ref Familiar 2 Nombre"
            placeholder="Nombre"
            required
          />
          <input
            type="text"
            name="Ref Familiar 2 Parentesco"
            placeholder="Parentesco"
            required
          />
          <input
            type="tel"
            name="Ref Familiar 2 Tel Trabajo"
            placeholder="Tel"
            required
            maxlength="9"
            pattern="\d{4}-\d{4}"
            placeholder="1234-5678"
          />
        </div>

        <!-- BOTONES -->
        <div class="btns">
          <button
            type="button"
            class="btn btn-secondary"
            id="prevBtn"
            onclick="nextPrev(-1)"
          >
            Atrás
          </button>
          <button
            type="button"
            class="btn btn-primary"
            id="nextBtn"
            onclick="nextPrev(1)"
          >
            Siguiente
          </button>
        </div>
      </form>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      let currentStep = 0;
      let steps = document.querySelectorAll(".step");
      let progressBar = document.getElementById("progressBar");
      let nextBtn = document.getElementById("nextBtn");
      let prevBtn = document.getElementById("prevBtn");
      let loadingOverlay = document.getElementById("loadingOverlay");

      // Format identity number (1234-5678-90123)
      function formatIdentity(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.length > 4) value = value.slice(0, 4) + "-" + value.slice(4);
        if (value.length > 9)
          value = value.slice(0, 9) + "-" + value.slice(9, 14);
        input.value = value.slice(0, 15);
      }

      // Format phone number (1234-5678)
      function formatPhone(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.length > 4)
          value = value.slice(0, 4) + "-" + value.slice(4, 8);
        input.value = value.slice(0, 9);
      }

      // Apply formatting to identity and phone inputs
      document
        .querySelectorAll(
          'input[name="Identidad"], input[name="Conyuge Identidad"]'
        )
        .forEach((input) => {
          input.addEventListener("input", () => formatIdentity(input));
        });

      document
        .querySelectorAll(
          'input[name="Teléfono Domicilio"], input[name="Celular"], input[name="Conyuge Teléfono"], input[name$="Tel Casa"], input[name$="Tel Trabajo"]'
        )
        .forEach((input) => {
          input.addEventListener("input", () => formatPhone(input));
        });

      // Show loading screen on page load
      window.addEventListener("load", function () {
        setTimeout(() => {
          loadingOverlay.style.opacity = "0";
          setTimeout(() => {
            loadingOverlay.style.display = "none";
          }, 500);
        }, 1200);
      });

      // MAPA DOMICILIO
      let map = L.map("map").setView([16.3, -86.55], 12);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(
        map
      );
      let markerDomicilio;
      map.on("click", function (e) {
        if (markerDomicilio) map.removeLayer(markerDomicilio);
        markerDomicilio = L.marker(e.latlng).addTo(map);
        document.getElementById("domicilioCoords").value =
          e.latlng.lat + "," + e.latlng.lng;
      });

      // MAPA TRABAJO
      let mapTrabajo = L.map("mapTrabajo").setView([16.3, -86.55], 12);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(
        mapTrabajo
      );
      let markerTrabajo;
      mapTrabajo.on("click", function (e) {
        if (markerTrabajo) mapTrabajo.removeLayer(markerTrabajo);
        markerTrabajo = L.marker(e.latlng).addTo(mapTrabajo);
        document.getElementById("trabajoCoords").value =
          e.latlng.lat + "," + e.latlng.lng;
      });

      showStep(currentStep);
      function showStep(n) {
        steps.forEach((step) => step.classList.remove("active"));
        steps[n].classList.add("active");

        if (steps[n].querySelector("#map"))
          setTimeout(() => map.invalidateSize(), 200);
        if (steps[n].querySelector("#mapTrabajo"))
          setTimeout(() => mapTrabajo.invalidateSize(), 200);

        prevBtn.style.display = n === 0 ? "none" : "block";

        let progress = ((n + 1) / steps.length) * 100;
        progressBar.style.width = progress + "%";

        nextBtn.innerText = n === steps.length - 1 ? "Enviar" : "Siguiente";
      }

      function nextPrev(n) {
        if (n === 1 && !validateForm()) return;
        currentStep += n;

        if (currentStep >= steps.length) {
          enviarForm();
          return;
        }
        showStep(currentStep);
      }

      function validateForm() {
        let inputs = steps[currentStep].querySelectorAll("input, select");
        let isValid = true;
        let estadoCivil = document.getElementById("estadoCivil").value;

        for (let input of inputs) {
          // Skip validation for Cónyuge fields if Estado Civil is Soltero
          if (
            estadoCivil === "Soltero" &&
            (input.id === "conyugeNombre" ||
              input.id === "conyugeIdentidad" ||
              input.id === "conyugeTrabajo" ||
              input.id === "conyugeCargo" ||
              input.id === "conyugeTelefono")
          ) {
            continue;
          }

          if (input.hasAttribute("required") && input.value === "") {
            input.style.borderColor = "#e63946";
            input.style.animation = "shake 0.3s";
            setTimeout(() => (input.style.animation = ""), 300);
            isValid = false;
          } else if (
            input.name === "Identidad" ||
            input.name === "Conyuge Identidad"
          ) {
            if (input.value && !/^\d{4}-\d{4}-\d{5}$/.test(input.value)) {
              input.style.borderColor = "#e63946";
              input.style.animation = "shake 0.3s";
              setTimeout(() => (input.style.animation = ""), 300);
              isValid = false;
            } else {
              input.style.borderColor = "#dfe6e9";
            }
          } else if (
            input.type === "tel" &&
            input.hasAttribute("required") &&
            input.value
          ) {
            if (!/^\d{4}-\d{4}$/.test(input.value)) {
              input.style.borderColor = "#e63946";
              input.style.animation = "shake 0.3s";
              setTimeout(() => (input.style.animation = ""), 300);
              isValid = false;
            } else {
              input.style.borderColor = "#dfe6e9";
            }
          } else if (input.name === "Salario" && input.value < 0) {
            input.style.borderColor = "#e63946";
            input.style.animation = "shake 0.3s";
            setTimeout(() => (input.style.animation = ""), 300);
            isValid = false;
          } else {
            input.style.borderColor = "#dfe6e9";
          }
        }
        return isValid;
      }

      function toggleConyuge() {
        let estado = document.getElementById("estadoCivil").value;
        let conyugeStep = document.getElementById("conyugeStep");
        let conyugeInputs = conyugeStep.querySelectorAll("input");

        conyugeStep.classList.toggle(
          "hidden",
          !(estado === "Casado" || estado === "Union Libre")
        );
        steps = document.querySelectorAll(".step");

        // Toggle required attribute for Cónyuge fields
        conyugeInputs.forEach((input) => {
          if (estado === "Casado" || estado === "Union Libre") {
            input.setAttribute("required", "");
          } else {
            input.removeAttribute("required");
          }
        });
      }

   
  function enviarForm() {
    loadingOverlay.style.display = "flex";
    loadingOverlay.style.opacity = "1";
    loadingOverlay.querySelector(".loading-text").textContent =
      "Enviando datos...";

    let form = document.getElementById("creditoForm");
    let data = new FormData(form);
    let queryString = new URLSearchParams(data);

    // ⬇️ Capturar parámetros de la URL (ejemplo: ?usuario=2113)
    let urlParams = new URLSearchParams(window.location.search);
    for (let [key, value] of urlParams.entries()) {
      queryString.append(key, value); // se agregan al envío
    }

    let scriptURL =
      "https://script.google.com/macros/s/AKfycbxd8D96neNYkA5T1QRhwOSYNvExXjwGH8i1kBArhV1RwICSJZGdvQbkkerJfrt-_Nk3/exec";

    fetch(`${scriptURL}?${queryString.toString()}`)
      .then((response) => response.text())
      .then((resp) => {
        loadingOverlay.querySelector(".loading-text").textContent =
          "Datos enviados correctamente. El asesor se contactará pronto con su persona";
        setTimeout(() => {
          window.location.reload();
        }, 1500);
      })
      .catch((err) => {
        loadingOverlay.querySelector(
          ".loading-text"
        ).textContent = `Error: ${err}`;
        setTimeout(() => {
          window.location.reload();
        }, 1500);
      });
  }


      // Escuchar cambios en la fecha de nacimiento
      document
        .getElementById("fechaNacimiento")
        .addEventListener("change", function () {
          const fechaNac = new Date(this.value);
          const hoy = new Date();
          let edad = hoy.getFullYear() - fechaNac.getFullYear();
          const mes = hoy.getMonth() - fechaNac.getMonth();

          // Ajuste si aún no cumplió años este año
          if (mes < 0 || (mes === 0 && hoy.getDate() < fechaNac.getDate())) {
            edad--;
          }

          document.getElementById("edad").value = edad >= 0 ? edad : "";
        });
    </script>
  </body>
</html>



